<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="./manifest.json" />
  <title>Photo Translator</title>
  <style>
    :root{
      --bg:#0b0b0c; --fg:#f2f2f2; --muted:rgba(255,255,255,.68);
      --panel:rgba(255,255,255,.06); --border:rgba(255,255,255,.12);
      --btn:rgba(255,255,255,.10); --btnb:rgba(255,255,255,.16);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;}
    #wrap{position:fixed;inset:0;display:grid;grid-template-rows:auto 1fr auto;gap:10px;
      padding:10px;box-sizing:border-box;}
    .panel{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:10px;}
    .bar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;}
    button,select,input{
      background:var(--btn);color:var(--fg);border:1px solid var(--btnb);
      border-radius:12px;padding:10px 12px;font-size:14px;line-height:1;
    }
    button{cursor:pointer; user-select:none; -webkit-tap-highlight-color: transparent;}
    button:active{transform:translateY(1px)}
    button:disabled{opacity:.5;cursor:not-allowed}
    .muted{color:var(--muted);font-size:12px}

    #stage{position:relative;display:grid;place-items:center;border-radius:14px;overflow:hidden;background:#000;width:100%;
      max-height:52vh;min-height:240px;aspect-ratio:4/3;}
    video,canvas{width:100%;height:100%;object-fit:cover;background:#000}
    canvas{display:none}
    @supports not (aspect-ratio: 1 / 1){ #stage{height:45vh;} }

    /* overlay: guarantees user gesture */
    .overlay{
      position:absolute; inset:0;
      display:grid; place-items:center;
      background:radial-gradient(circle at 50% 40%, rgba(0,0,0,.25), rgba(0,0,0,.65));
      padding:14px;
    }
    .overlayInner{display:flex; flex-direction:column; gap:10px; align-items:center; text-align:center;}
    .overlayBtn{
      background:rgba(255,255,255,.14);
      border:1px solid rgba(255,255,255,.28);
      padding:14px 16px;
      border-radius:14px;
      font-size:16px;
      font-weight:700;
      min-height:48px;
      width:min(320px, 92vw);
    }
    .overlayNote{max-width:min(420px, 92vw);}

    #tags{max-height:30vh;overflow:auto}
    .tag{display:block}
    .tline{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 0;border-bottom:1px solid rgba(255,255,255,.08);}
    .tleft{display:flex;align-items:baseline;gap:8px;min-width:0}
    .tlang{font-size:12px;color:var(--muted);white-space:nowrap}
    .tmain{font-size:15px;font-weight:700;line-height:1.2;cursor:pointer;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
    .tgloss{font-size:12px;color:var(--muted);white-space:nowrap;cursor:pointer}
    .tright{display:flex;align-items:center;gap:8px;white-space:nowrap}
    .sbtn{padding:10px 12px;border-radius:12px;min-height:44px;min-width:44px}
    .score{color:var(--muted);font-size:12px;white-space:nowrap}

    /* Mobile: bigger controls */
    @media (pointer: coarse){
      #wrap{gap:12px;padding:12px;}
      button,select{font-size:16px;padding:14px 14px;min-height:48px}
      .sbtn{min-height:48px;min-width:48px;font-size:18px}
      .tmain{font-size:16px}
      #stage{min-height:260px;max-height:54vh}
    }
  </style>
</head>
<body>
  <div id="wrap">
    <div class="panel bar" role="toolbar" aria-label="controls">
      <div class="row">
        <button id="btnStartCam" type="button">ğŸ“· ã‚«ãƒ¡ãƒ©</button>
        <button id="btnCapture" type="button">ğŸ“¸ æ’®å½±</button>
        <button id="btnRetake" type="button" style="display:none">â†© æ’®ã‚Šç›´ã—</button>
        <button id="btnPick" type="button">ğŸ–¼ ç”»åƒ</button>
        <button id="btnAnalyze" type="button" disabled>ğŸ” ã‚¿ã‚°è§£æ</button>
        <input id="fileInput" type="file" accept="image/*" style="display:none" />
      </div>
      <div class="row">
        <span class="muted">Top-K</span>
        <select id="topk" aria-label="Top-K">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="30" selected>30</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="200">200</option>
        </select>
      </div>
    </div>

    <div id="stage" class="panel">
      <video id="cam" autoplay muted playsinline></video>
      <canvas id="shot"></canvas>

      <div id="camOverlay" class="overlay">
        <div class="overlayInner">
          <button id="btnOverlayStart" class="overlayBtn" type="button">ã‚¿ãƒƒãƒ—ã—ã¦ã‚«ãƒ¡ãƒ©èµ·å‹•</button>
          <div class="muted overlayNote">
            åˆå›ã¯ã€Œè¨±å¯ã€ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚èµ·å‹•ã—ãªã„å ´åˆã¯ã€ç«¯æœ«ã®<b>ã‚µã‚¤ãƒˆè¨­å®š</b>ã§ã‚«ãƒ¡ãƒ©ã‚’ã€Œè¨±å¯ã€ã«ã—ã¦ãã ã•ã„ã€‚
          </div>
        </div>
      </div>
    </div>

    <div class="panel">
      <div id="status" class="muted">èª­ã¿è¾¼ã¿ä¸­â€¦</div>
      <div id="tags" class="muted">ã¾ã è§£æã—ã¦ã„ã¾ã›ã‚“ã€‚</div>
    </div>
  </div>

  <script src="./app.js"></script>
</body>
</html>
