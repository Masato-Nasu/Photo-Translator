name: Wake Hugging Face Space

on:
  schedule:
    # 06:55 JST = 21:55 UTC（前日）
    - cron: "55 21 * * *"
  workflow_dispatch:

concurrency:
  group: wake-hf-space
  cancel-in-progress: true

jobs:
  wake:
    runs-on: ubuntu-latest
    steps:
      - name: Wake (hit root then /health)
        run: |
          set -u

          ROOT="https://mazzgogo-photo-translator.hf.space/"
          HEALTH="https://mazzgogo-photo-translator.hf.space/health"

          echo "Hitting root once: $ROOT"
          curl -sS -L --max-time 20 "$ROOT" -o /dev/null || true

          echo "Hitting /health with retries: $HEALTH"
          for i in 1 2 3 4 5 6; do
            echo "Attempt $i..."
            http_code=$(curl -sS -L --max-time 20 -o response.json -w "%{http_code}" "$HEALTH" || true)
            echo "HTTP $http_code"
            cat response.json 2>/dev/null || true

            if [ "$http_code" = "200" ]; then
              echo "OK (Space is responding)"
              exit 0
            fi

            sleep 15
          done

          echo "Done (wake request sent)"
          exit 0
